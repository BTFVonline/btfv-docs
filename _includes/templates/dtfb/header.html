{% assign template_date = page.date | default: "" %}
<header class="dtfb-hero">
    <div class="dtfb-hero__band"></div>
    <div class="dtfb-hero__content">
        <div class="dtfb-hero__brand">
            <img class="dtfb-hero__logo" src="{{ "/templates/dtfb/images/DTFB-logo.png" | relative_url }}" alt="DTFB Logo">
            <div class="dtfb-hero__titles">
                <div class="dtfb-hero__title">{{ page.title }}</div>
                {% if page.subtitle %}
                    <div class="dtfb-hero__subtitle">{{ page.subtitle }}</div>
                {% endif %}
            </div>
        </div>
        <div class="dtfb-hero__meta">
            {% if template_date != "" %}
                <div class="dtfb-hero__meta-item">Stand: {{ template_date }}</div>
            {% endif %}
            <div class="dtfb-hero__links">
                {% if page.pdf %}
                    <a href="{{ page.pdf | relative_url }}" target="_blank" rel="noopener">PDF</a>
                {% endif %}
                {% if page.source %}
                    <a href="{{ page.source }}" target="_blank" rel="noopener">Quelle</a>
                {% endif %}
                <button class="dtfb-theme-toggle" type="button" data-theme-toggle aria-label="Theme wechseln" aria-pressed="false">
                    <span class="dtfb-theme-toggle__icon" data-theme-icon>
                        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <circle cx="12" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="2"/>
                            <g stroke="currentColor" stroke-width="2" stroke-linecap="round">
                                <line x1="12" y1="2.5" x2="12" y2="5.5"/>
                                <line x1="12" y1="18.5" x2="12" y2="21.5"/>
                                <line x1="2.5" y1="12" x2="5.5" y2="12"/>
                                <line x1="18.5" y1="12" x2="21.5" y2="12"/>
                                <line x1="4.5" y1="4.5" x2="6.8" y2="6.8"/>
                                <line x1="17.2" y1="17.2" x2="19.5" y2="19.5"/>
                                <line x1="17.2" y1="6.8" x2="19.5" y2="4.5"/>
                                <line x1="4.5" y1="19.5" x2="6.8" y2="17.2"/>
                            </g>
                        </svg>
                    </span>
                </button>
            </div>
        </div>
    </div>
</header>
<script>
(() => {
    const root = document.documentElement;
    const toggle = document.querySelector('[data-theme-toggle]');
    const icon = document.querySelector('[data-theme-icon]');
    if (!toggle || !icon) return;

    const renderIcon = (mode) => {
        if (mode === 'dark') {
            icon.innerHTML = '<svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path d="M21 14.5A8.5 8.5 0 1 1 9.5 3a7 7 0 0 0 11.5 11.5Z" fill="none" stroke="currentColor" stroke-width="2"/></svg>';
        } else {
            icon.innerHTML = '<svg viewBox="0 0 24 24" aria-hidden="true" focusable="false"><circle cx="12" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="2"/><g stroke="currentColor" stroke-width="2" stroke-linecap="round"><line x1="12" y1="2.5" x2="12" y2="5.5"/><line x1="12" y1="18.5" x2="12" y2="21.5"/><line x1="2.5" y1="12" x2="5.5" y2="12"/><line x1="18.5" y1="12" x2="21.5" y2="12"/><line x1="4.5" y1="4.5" x2="6.8" y2="6.8"/><line x1="17.2" y1="17.2" x2="19.5" y2="19.5"/><line x1="17.2" y1="6.8" x2="19.5" y2="4.5"/><line x1="4.5" y1="19.5" x2="6.8" y2="17.2"/></g></svg>';
        }
    };

    const applyTheme = (mode) => {
        root.setAttribute('data-theme', mode);
        toggle.setAttribute('aria-pressed', mode === 'dark' ? 'true' : 'false');
        renderIcon(mode);
    };

    const stored = localStorage.getItem('dtfb-theme');
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (stored === 'light' || stored === 'dark') {
        applyTheme(stored);
    } else if (prefersDark) {
        applyTheme('dark');
    } else {
        applyTheme('light');
    }

    toggle.addEventListener('click', () => {
        const next = root.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        applyTheme(next);
        localStorage.setItem('dtfb-theme', next);
    });
})();
</script>
